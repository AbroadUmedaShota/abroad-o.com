# アンケート新規作成ページ仕様書

## 1. 概要

本ドキュメントは、アンケート新規作成ページの画面仕様と機能要件を定義する。
このページでは、ユーザーが新しいアンケートを作成するための各種設定を行う。

## 2. 画面レイアウト

画面は主に3つのエリアで構成される。

- **ヘッダー:** 全ページ共通のヘッダー。ブランドロゴ、ユーザー情報が表示される。
- **サイドバー:** 全ページ共通のナビゲーションメニュー。
- **メインコンテンツ:** アンケート作成フォームが配置される主要な作業エリア。

## 3. 入力項目

メインコンテンツは、以下のセクションに分かれている。

### 3.1. 基本情報

アンケートの基本的な情報を設定する。

| 項目名 | ID | タイプ | 必須 | 説明 |
| :--- | :--- | :--- | :--- | :--- |
| アンケート名（社内管理用） | `surveyName` | テキスト入力 | ✔ | ユーザーが社内で管理するためのアンケート名。 |
| 表示タイトル（回答者向け）| `displayTitle` | テキスト入力 | ✔ | 回答者がアンケートページで目にするタイトル。 |
| 説明 | `description` | テキストエリア | | アンケートの説明文。回答者向けに表示される。 |
| 回答受付開始日 | `periodStart` | 日付選択 | ✔ | アンケートの回答受付を開始する日付。 |
| 回答受付終了日 | `periodEnd` | 日付選択 | ✔ | アンケートの回答受付を終了する日付。 |
| プラン | `plan` | プルダウン | ✔ | 利用するプランを選択。（Standard / Premium） |
| データ化完了希望日 | `deadline` | 日付選択 | | 名刺データのデータ化完了を希望する日付。 |

### 3.2. 名刺データ関連

名刺のデータ化に関する設定を行う。

| 項目名 | ID | タイプ | 必須 | 説明 |
| :--- | :--- | :--- | :--- | :--- |
| 名刺データ化 | `bizcardEnabled` | プルダウン | | 名刺のデータ化機能を利用するかどうか。（有効 / 無効） |
| 名刺データ化依頼枚数 | `bizcardRequest` | 数値入力 | | データ化を依頼する名刺のおおよその枚数。 |

### 3.3. お礼メール設定

回答者へのお礼メールの送信方法を設定する。

| 項目名 | ID | タイプ | 必須 | 説明 |
| :--- | :--- | :--- | :--- | :--- |
| お礼メール | `thankYouEmailSettings` | プルダウン | | 送信方法を選択。（自動送信 / 手動 / 設定なし） |

### 3.4. メモ

管理用のメモを残すことができる。

| 項目名 | ID | タイプ | 必須 | 説明 |
| :--- | :--- | :--- | :--- | :--- |
| メモ | `memo` | テキストエリア | | 社内管理用の自由記述欄。 |

## 4. 質問項目設定

アンケートの質問項目を動的に追加・編集するエリア。

### 4.1. 質問追加ボタン

以下のボタンをクリックすることで、対応する質問タイプの入力フォームが `questionItemsContainer` に追加される。

- フリーアンサー (`addFreeAnswerBtn`)
- シングルアンサー (`addSingleAnswerBtn`)
- マルチアンサー (`addMultiAnswerBtn`)
- マトリックス(SA) (`addMatrixSABtn`)
- マトリックス(MA) (`addMatrixMABtn`)
- 日付/時間 (`addDateTimeBtn`)
- 手書きスペース (`addHandwritingBtn`)

### 4.2. 質問項目コンテナ

- ID: `questionItemsContainer`
- 追加された質問フォームがこのエリアに表示される。
- 各質問フォームには、質問内容の入力、選択肢の追加・削除、必須設定などの機能が含まれる（※詳細な仕様は別途定義）。

## 5. アンケートプレビュー

- ID: `surveyPreviewContainer`
- 「質問項目設定」で追加・編集された内容が、リアルタイムで回答者向けの表示に近い形でプレビューされる。
- 初期状態では「質問項目を追加するとプレビューが表示されます。」というメッセージが表示される。

## 7. UI/UX改善履歴

### 7.1. フローティングボタン（質問追加ボタン）の改善

ユーザーからのフィードバックに基づき、質問追加ボタンの視認性と操作性を向上させるための改善を実施した。

- **デザイン変更**: 単なる「+」アイコンから、テキストラベル付きの拡張フローティングアクションボタン（Extended FAB）に変更。
  - **目的**: ボタンの機能（質問を追加する）をより明確にユーザーに伝える。
  - **実装**: アイコン (`material-icons`) とテキスト (`<span>質問を追加</span>`) を組み合わせたHTML構造に変更。

- **スクロール時の表示切り替え**: ページをスクロールする際に、FABのテキストラベルが自動的に隠れるようにした。
  - **目的**: スクロール中にボタンが画面を占有する領域を減らし、コンテンツの視認性を確保する。
  - **実装**: `main-content` のスクロールイベントを監視し、スクロール方向に応じてテキストの `width` と `opacity` を切り替えるCSSクラスを適用。

- **クリックとドラッグの判定**: FABのクリックとドラッグ操作をより厳密に区別するようにした。
  - **目的**: ユーザーの意図しないメニューの表示を防ぎ、操作の精度を向上させる。
  - **実装**: `mousedown` と `mouseup` イベント間のマウス移動距離を閾値 (`clickThreshold`) で判定し、閾値以下の移動の場合のみクリックとしてメニューを開く。

- **メニュー表示位置の最適化**: FABから開かれる質問タイプ選択メニューの表示位置を改善した。
  - **目的**: メニューが画面外にはみ出さず、常にユーザーにとって見やすい位置に表示されるようにする。
  - **実装**: 
    1.  当初はボタンの画面上の象限に基づいて表示位置を決定するロジックを導入。
    2.  その後、「ボタンの直下に表示し、画面下部にはみ出す場合のみ上部に表示する」ロジックに変更。
    3.  最終的に、複雑な動的計算を避け、**画面右下固定**の配置に戻した。
        - **理由**: 動的な位置計算は様々な画面サイズやコンテンツ量で予期せぬ挙動を引き起こす可能性があり、シンプルで予測可能な固定位置が最も安定したユーザー体験を提供すると判断した。

- **メニューの自動クローズ**: スクロールまたはブラウザのリサイズ時に、開いているメニューを自動的に閉じるようにした。
  - **目的**: ボタンとメニューの位置がずれることによる違和感を解消し、操作の文脈を明確にする。
  - **実装**: `window` の `scroll` および `resize` イベントを監視し、メニューに `opacity-0`, `scale-95`, `pointer-events-none` クラスを適用して非表示にする。

## 8. 今後の課題

- プレビュー機能の実装
- フォームの入力値保存・送信機能の実装
- 入力バリデーションの強化
