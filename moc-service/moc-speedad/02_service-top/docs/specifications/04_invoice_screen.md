# 請求書確認機能 仕様書

## 1. 概要
ユーザーが自身のサービス利用状況とそれに対応する請求内容をオンラインで確認できるようにするための機能。
請求書の発行から通知までを自動化し、管理コストを削減することを目的とする。

## 2. 主な機能
- **請求書一覧表示機能**: 過去の請求書を一覧で確認できる。
- **請求書詳細表示機能**: 各月の請求明細を確認できる。
- **請求書発行とメール通知機能**: 月末に請求書を自動発行し、ユーザーにメールで通知する。

## 3. 画面仕様
### 3.1. 請求書一覧画面 (`invoiceList.html`)
- **目的**: ユーザーが過去の請求履歴を俯瞰できるようにする。
- **レイアウト**: 既存のダッシュボード画面と同様のテーブル形式。
- **表示項目**:
    - 発行月
    - 請求金額
    - 支払状況 (例: 支払済, 未払, 処理中)
- **操作**:
    - 各行をクリックすると、対応する月の請求書詳細画面に遷移する。

### 3.2. 請求書詳細画面 (`invoiceDetail.html`)
- **目的**: ユーザーが請求内容の詳細を確認し、必要に応じて出力できるようにする。
- **レイアウト**: 一般的な請求書のフォーマットに準拠したレイアウト。
- **表示項目**:
    - 請求書番号
    - 発行日
    - 支払期限
    - 請求先情報 (アカウント情報から自動入力)
    - **請求明細**:
        - 月額基本サービス料
        - アンケートごとの利用料
        - その他オプション利用料
    - 小計
    - 消費税
    - 合計請求額
- **操作**:
    - 印刷ボタン: ブラウザの印刷機能を呼び出す。
    - PDFダウンロードボタン: 画面の内容をPDF形式でダウンロードする。

## 4. データモデル (案)
請求情報を管理するためのデータ構造案。`data/invoices.json`のようなファイルで管理することを想定。

```json
[
  {
    "invoiceId": "inv-202507-001",
    "accountId": "acc-12345",
    "issueDate": "2025-07-31",
    "dueDate": "2025-08-31",
    "totalAmount": 55000,
    "tax": 5000,
    "status": "unpaid",
    "items": [
      {
        "itemName": "月額基本サービス料 (2025年7月分)",
        "amount": 30000
      },
      {
        "itemName": "アンケート「A展示会来場者アンケート」利用料",
        "amount": 20000
      }
    ]
  }
]
```

## 5. デザイン仕様

- **基本方針**: 既存のデザインガイドライン(`docs/design/00_design_guideline.md`)に準拠し、アプリケーション全体で一貫性のあるUIを提供する。
- **コンポーネント**: `card`, `table`, `button`など、既存のCSS(`service-top-style.css`)で定義されたスタイルを再利用する。
- **レスポンシブ**: モバイル端末でも見やすいように、テーブルはレスポンシブ対応とする。

### 5.1. 請求書一覧画面 (`invoiceList.html`)
- **レイアウト**: メインコンテンツエリアに`card`を配置し、その中にテーブルを設置する。
- **支払状況**: ステータスに応じて以下のバッジを使用する。
    - `未払`: `<span class="badge bg-warning text-dark">未払</span>`
    - `支払済`: `<span class="badge bg-success text-white">支払済</span>`
    - `処理中`: `<span class="badge bg-info text-white">処理中</span>`
- **詳細ボタン**: `btn-outline-primary` スタイルを適用し、主要なアクションではないことを示す。

### 5.2. 請求書詳細画面 (`invoiceDetail.html`)
- **アクションボタン**:
    - `印刷`: `<button class="btn btn-outline-secondary"><i class="bi bi-printer"></i> 印刷</button>`
    - `PDFダウンロード`: `<button class="btn btn-primary"><i class="bi bi-download"></i> PDFダウンロード</button>` (プライマリアクション)
- **明細テーブル**: `table-bordered` を使用して情報を明確に区切り、合計金額は `fw-bold` で強調する。

## 6. 主要シーケンス
### 請求書発行・通知フロー
1.  **[システム]** 毎月月末の夜間にバッチ処理を実行する。
2.  **[システム]** 各アカウントの当月利用状況を集計し、請求データを作成する。
3.  **[システム]** 作成した請求データを`invoices.json`に保存する。
4.  **[システム]** ユーザーの登録メールアドレス宛に、請求書詳細画面へのユニークなURLを記載した通知メールを送信する。
5.  **[ユーザー]** メール内のURLをクリックする。
6.  **[ブラウザ]** 請求書詳細画面(`invoiceDetail.html`)を表示する。
